import git
import re
import json


def git_pull():
    repo = git.Repo('/Users/macbookpro/PycharmProjects/mts-cve-parser/cvelist')
    o = repo.remotes.origin
    return o.pull()


def git_add():
    repo = git.Repo('/Users/macbookpro/PycharmProjects/mts-cve-parser')
    return repo.git.add(all=True)


def git_commit():
    repo = git.Repo('/Users/macbookpro/PycharmProjects/mts-cve-parser')
    return repo.index.commit("Commit with GitPython")


def git_diff():
    repo = git.Repo("/Users/macbookpro/PycharmProjects/mts-cve-parser")
    diff_result = repo.git.diff("--submodule=diff", "HEAD^")

    new_file = set(re.findall(r"CVE-[0-9]+-[0-9]+.json\n@@ -0,0", diff_result))
    edit_file = set(re.findall(r"CVE-[0-9]+-[0-9]+.json\n@@ -[1-9]", diff_result))

    new = [i[:-8] for i in new_file]
    edited = [i[:-6] for i in edit_file]

    json_format = {"new":new, "edited":edited}

    return json.dumps(json_format)

